\documentclass[letterpaper,12pt]{article}
%documentclass[superscriptaddress,preprintnumbers,amsmath,amssymb,aps,11pt]{revtex4}
%\usepackage[]{authblk}
%\usepackage{graphics}
\usepackage[dvipdf]{graphics}
%\usepackage{subfig}  % For subfloats
\usepackage{color}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{epsfig}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage{caption}
%\usepackage{subcaption}
\usepackage{subfig}
\usepackage{authblk}
\usepackage{url}

\oddsidemargin = -14mm
\topmargin = -2.9cm
\textwidth = 19cm
\textheight = 24cm

\def \rarr {\rightarrow}
\def \grinp {\includegraphics}
\def \tw {\textwidth}
\def\dfrac#1#2{\displaystyle{{#1}\over{#2}}}
\def \dstl {\displaystyle}
\definecolor{GREEN}{rgb}{0.,0.8,0}
\definecolor{RED}{rgb}{1,0,0}
\definecolor{ORANGE}{rgb}{1,0.5,0}

\author{Bump hunt folks}
\title{Resonance search analysis of 2016 HPS spring run data.}

\begin{document}

\maketitle

\tableofcontents
\newpage

\section*{Introduction}

The Heavy Photon Search (HPS) experiment has capability to search for a so called heavy photon ($A^{\prime}$) with two complementary methods.


\section{Data set}
Describe the data, beam energy, beam current, target runs, etc.

\section{Event Selections}
This section describes all the cuts that are applied to get the final vertex candidate distribution. 
The main goal of event selection cuts is to maximize signal sensitivity.

In this analysis only events with ``Pair1'' trigger (see \cite{TriggerNote} for the description of HPS triggers) are used.

\subsection{Cluster timing cuts}\label{sec:cldTcuts}
The readout window of ECal FADC data is 200 ns. Clusters coming from the physics events, that generated the trigger, are located in a narrow time range (few ns width because of the trigger jitter) in the readout window around $\mathrm{t = 56\; ns}$.
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
 \centering
 \subfloat{\label{fig:clE_t:Top}\grinp[width=0.45\tw]{Figs/cl_t_E_Top.pdf}}
 \subfloat{\label{fig:clE_t:Bot}\grinp[width=0.45\tw]{Figs/cl_t_E_Bot.pdf}}
 \caption{``time vs Energy'' distributions of ECal clusters in the Top (Left) and Bottom (Right) half. Red curves in the in the right plot indicate cuts that are applied to clusters in the bottom half for the initial cluster selection. See the text for the description of the difference between left and right plots.}
 \label{fig:cl_E_T_plots}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In Fig.\ref{fig:cl_E_T_plots} shown ``time vs Energy'' distributions of ECal clusters in the Top (Left) and Bottom (Right) halves. The bulge of events in the right plot are clusters that generated the trigger, and also trigger time is defined by these clusters. The noticeable energy dependence is due to the so called ``time walk Corrections'' \cite{ECalTimeCorr}. During initial event selection only clusters that are inside the outlined red curves are used, since the rest are accidentals that didn't come from the beam bunch generating the trigger. One can notice that for the clusters in the top half, in addition to the central bulge, there is an extra occupancy of events in region ($\mathrm{ 40\;ns < t_{cl} < 70\;ns }$). This is because the coincidence time between clusters in the ``Pair'' trigger was $\mathrm{12\;ns}$ \cite{TriggerNote}, and the trigger time is determined by the bottom cluster. Unlike to clusters in the bottom half, in the initial event selection, we have not cut on time of the top cluster, but rater we have applied cut on the cluster time difference between top and bottom clusters.
\subsubsection{Ad hoc ECal time corrections}
The next step is to cut pairs of top-bottom clusters that are far from each other in terms of time.
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
 \centering
 \grinp[width=0.75\tw]{Figs/cl_dt_UncrAndCorr.pdf}
 \caption{Time difference between top and bottom clusters at high $\mathrm{E_{sum}}$ region. Dashed red lines show uncorrected clusters, and the blue curve show corrected clusters.}
 \label{fig:clTimeUncorCorr}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
During the analysis is was found that ECal cluster times can be improved, in particular the dashed red histogram in Fig.\ref{fig:clTimeUncorCorr} shows the time difference between top and bottom clusters\footnote{For the sake of better visualization, the plot doesn't fully show the entire central peak. } at high $\mathrm{E_{sum}}$ region ($\mathrm{1.9\;GeV  < E_{Sum} < 2.4\; GeV}$). As one can see there is a bump at around $\mathrm{2\;ns}$, while the at $\mathrm{-2\;ns}$ there is no clear bump. This suggests that time offsets of some crystals might be wrong.
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb] 
 \centering
 \subfloat{\label{fig:timeCorr_clyxc}\grinp[width=0.95\tw]{Figs/ECal_YX_timeCorr.pdf}}\\
 \subfloat{\label{fig:timeCorrGrTop}\grinp[width=0.95\tw]{Figs/gr_TopCorrections.pdf}}\\
 \subfloat{\label{fig:timeCorrGrBot}\grinp[width=0.95\tw]{Figs/gr_BotCorrections.pdf}}\\
 \caption{Time Corrections for each crystal.}
 \label{fig:CrystalTimeCorr}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
To check this, for each crystal the time difference between that crystal and it's pair (in opposite half) crystal is constructed. The Top 2D plot of
Fig. \ref{fig:CrystalTimeCorr} shows mean values of each of crystals. 
The middle and the bottom plots show same mean values as a function of crystal $\mathrm{X}$ index for Top and Bottom crystal respectively. Different markers show different rows. 
As one can see crystals (-18, -1) and (-6, -3) are shifted from their immediate neighbors  by about 2 ns. There are some other crystals which are shifted significantly too (but less than 2ns). These include for example crystals (-16, -5), (10, -5), (10, 1) and (10, 2). In addition to this, we see that there is a general crystal X index (and slightly Y index) dependence too. In reality crystal X index is correlated to the charged particle energy too, and the original dependence might be not on X but on energy. Studying it is out of the scope of this note, and here for each crystal we have corrected the time, by subtracting these calculated mean values from the reconstructed cluster time.
After the correction the cluster time difference is depicted by blue solid line in Fig.\ref{fig:clTimeUncorCorr}. One can see that the excess of events at 2 ns disappeared. Dips and peaks between bumps indicating difference beam bunches also got sharper, which is an indication of an improvement of the cluster time resolution.

\subsubsection{Fitting Cluster time difference}
After correction of individual cluster times, the Top-Bottom cluster time difference was fitted with a following function:
\begin{equation}
 \displaystyle \mathrm{F = \sum_{i = 0}^{N_{peak}} a_{i}\cdot\left(Gaus(x - \mu^{1}_{i}, \sigma^{1}_{i}) + b\cdot Gaus(x - \mu^{2}_{i}, \sigma^{2}_{i})  \right)}
\end{equation}
where $\mathrm{N_{peak}}$ is the number of peaks. Each peak is described by the sum of two Gaussian functions $\mathrm{Gaus(x - \mu^{1}_{i}, \sigma^{1}_{i})}$ and $\mathrm{Gaus(x - \mu^{2}_{i}, \sigma^{2}_{i})}$ with their amplitude ratio ``b'.
The parameter ''b`` is the same for all peaks. 
In the fit, free parameters are $\mathrm{a_{i},\; \mu^{1}_{i},\; \sigma^{1}_{i},\; \mu^{2}_{i},\; \sigma^{2}_{i},\; b }$. 

The fit result is shown in Fig.\ref{fig:cldTFits}. Different peak components of the
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
 \centering
 \subfloat[]{\label{fig:cldTFitLin1}\grinp[width=0.32\tw]{Figs/Calo_dt_Fit_lin1.pdf}}
 \subfloat[]{\label{fig:cldTFitLog1}\grinp[width=0.32\tw]{Figs/Calo_dt_Fit_log1.pdf}}
 \subfloat[]{\label{fig:cldTFitZoom1}\grinp[width=0.32\tw]{Figs/Calo_dt_Fit_zoom1.pdf}}
 \caption{Fit of the Top and Bottom cluster time difference. Left: linear scale, Middle: Log scale and right: Linear scale but includes only low magnitude peaks. Main Gaussian functions are represented by solid lines, and the secondary Gaussian (with wider width and lower magnitude) are represented by dashed lines.}
 \label{fig:cldTFits}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function are depicted by different color. The main Gaussian function of each peak is represented by a solid line, while the secondary Gaussian is represented with a dashed line. One can see that this function fits the distribution reasonably well.

Then in order to determine the optimal cut on the cluster time difference, we will use the value, which maximizes the $\mathrm{\dfrac{S}{\displaystyle \sqrt{S + Bgr}}}$ ratio, where ''S`` is the signal (in our case the central peak), and ''S + Bgr`` is the signal plus Background (the total fit function).
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
 \centering
 \grinp[width=0.75\tw]{Figs/dt_cur_optimize1_zoom.pdf}
 \caption{The $\mathrm{\frac{\displaystyle S}{\displaystyle \sqrt{S + Bgr}}} $ ratio as a function of cluster time difference cut. The Dashed line indicates the maximum of the function.}
 \label{fig:cl_dtOptimumCut}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The $\mathrm{\frac{\displaystyle S}{\displaystyle \sqrt{S + Bgr}}} $ ratio as a function of cluster time difference cut is shown in Fig.\ref{fig:cl_dtOptimumCut}, where the maximum value at $\mathrm{\Delta t < 1.43\;ns}$ is indicated by a vertical dashed line.

\subsection{Two dimensinal cuts}
Some of event selections cuts described below are two dimensinal cuts, i.e. the cut value depends on the value of another variable. In most of cases two dimensional cuts are implemented as a function of particle's momentum.

In general, to study the distribution of a given variable for a ''signal like`` particle, the rest of event selection cuts are applied, to make as clean as possible signal.  
The only exception is the two cluster time difference cut, which is described in section \ref{sec:cldTcuts} ).
Applying the rest of cuts except the one under the investigation, will ensure the 
accidental background is minimal (negligible), and the resulting distribution will represent actuall signal (the $e^{-}$, $e^{+}$, ($X$) final state). In most of cases the distribution is not Gaussian, even when it represent a small momentum bin.
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
 \centering
 \grinp[width=0.75\tw]{Figs/CutLimitTests.pdf}
 \caption{Illustration of  $3\sigma$ cut limits vs $99\%$ cut limits on a toy distribution.}
 \label{fig:CutLimitIllustration}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In such cases, the conventional $\pm 3\sigma$ cuts will not be will not keep $99.7\%$ but rather might cut more events. As an example in Fig.\ref{fig:CutLimitIllustration} shown a toy distribution which is not a pure Gaussian, but rather has a tail on the left side. The Gaussian fit is shown on top if the histogram and $\pm 3\sigma$ limits are shown by vertical red lines. One can see that $-3\sigma$ limit will cut several $\%$ of events rather than $0.3\%$. Instead it was decided to choose left and right cuts limits such that will keep $99\%$ of the signal and will throw $0.5\%$ of signal events from each side. In this particular case $99\%$ cut limits are shown by blue vertical lines. \newline \indent
There are some special cases in this algorithm, which are explained below. 
\vskip 1cm
1. The number of events in the one dimensional projected histogram is too low. In this case, when then number of events is below 45, then the entire momentum bin is considered as out of acceptance. Note: the data sample that we use, has such statistics, that two dimensional original histograms that we use have about 200K or more events, and binning is chosen such, that the total number of events that are in the ''$N < 45$`` category one dimensional histograms are significantly less than $1\%$ of the original two dimensional histogram.
\vskip 1cm
2. The number of events in the one dimensional histogram is more than 45, however it is not high enough (order of thousands). In this case the $0.5\%$ events that should be cut out from each side of the distribution is very small number e.g. 1, 2, 3 or even 0, if the number of events is in between 45 and 200. So in order to apply some cuts rather than no-cut or very loose cut, the $99\%$ requirement is released for histograms having less than 500 events ($N < 500$).
In general the cut limits for different statistic cases are summarized
\begin{table}[!htb]
 \centering
 \begin{tabular}{|l|r|}
  \hline
  $\#$ of events & cut limit \\ \hline
  $\mathrm{ N > 500}$ & $98\%$ \\ \hline
  $\mathrm{200 < N < 500}$ & $98\%$ \\ \hline
  $\mathrm{100 < N < 200}$ & $96\%$ \\ \hline
  $\mathrm{45 < N < 100}$ & $95\%$ \\ \hline
  $\mathrm{N < 45}$ & $0\%$ \\ \hline
 \end{tabular}
\caption{Cut limits for different statistic scenarios.}
\label{tb:2DCutLimits}
\end{table}


\subsection{Track-Cluster Matching}
The offline reconstruction code forms particles by matching tracks and clusters to each other, by utilizing spatial coordinate and time differences between tracks and clusters.
In the offline reconstruction the matching is quite loose (''Better to keep junk, rather than throwing a good particle``). In this section spatial and time matching cuts are described. Both, time and position resolution of $e^{-}$ and $e^{+}$ clusters depend on particle momentum. The precision of the track projected coordinate at the ECal face does depend on the track momentum too. Because of these reasons we studied track-cluster matching as a function of momentum.

\subsubsection{time matching}
In addition to the momentum dependence we noticed also slight difference between top and bottom sectors, therefore two separate cuts are developed for each detector half.
% %%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
 \centering
 \subfloat[]{\label{fig:ClTrkDtBot}\grinp[width=0.45\tw]{Figs/trk_cl_timeDiffCut_Bot_Data.pdf}}
 \subfloat[]{\label{fig:ClTrkDtTop}\grinp[width=0.45\tw]{Figs/trk_cl_timeDiffCut_Top_Data.pdf}}
 \caption{Cluster-Track time difference as a function of particle momentum. Left plot represents particles in the bottom half, and the right plot represents particles in the top half of the detector. The area marked by Red dots represents the acceptance region. }
 \label{fig:ClTrkTimeMatch}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%% F I G U R E %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In Fig.\ref{fig:ClTrkTimeMatch} shown Cluster-Track time difference as a function of particle momentum. Left plot represents particles in the bottom half, and the right plot represents particles in the top half of the detector. The area marked by Red dots represents the acceptance region.


\subsection{Track $\chi^{2}$ cuts}

\subsection{WAB Suppression cuts}
Describe L1 and $\mathrm{d_{0}}$ cuts. \\
Mention why L1 is important, addition of suppressing WABs, it also significantly
improves the mass resolution.


\section{Parametrization of Mass resolution.}

\section{Bump hunt analysis}


\section{Study of systematics}
Here goes studies on systematics

\begin{thebibliography}{55}
 \bibitem{TriggerNote} Kyle McCarty, Valery Kubarovsky and Benjamin Raydo, ``Description and Tuning of the HPS Trigger'', HPS Note 2018-002
 \bibitem{ECalTimeCorr} Holly Szumila-Vance, ``HPS Ecal Timing Calibration for the
Spring 2015 Engineering Run'', HPS Note 2015-011.
\end{thebibliography}

 
\end{document}
